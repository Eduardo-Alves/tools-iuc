<tool id="jbrowse" name="JBrowse" version="0.1">
  <description>genome browser</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <expand macro="stdio"/>
  <version_command>python jbrowse.py --version</version_command>
  <command interpreter="python"><![CDATA[jbrowse.py
$positional_1
$trackYaml

--jbrowse \${JBROWSE_SOURCE_DIR}
--outdir $default.files_path
> $default]]></command>
  <configfiles>
      <configfile name="trackYaml">
---
#for track in $data_tracks.data_format
  -
    file: $track.annotation
    ext: $track.annotation.ext
    label: "$track.label"
    #if str($data_tracks.data_format.data_format_select) == "wiggle"
    options:
        type: $track.xyplot
        variance_band: $track.var_band
        autoscale: $track.autoscale
    #end if
#end for
      </configfile>
  </configfiles>
  <inputs>
    <param label="Genome" name="positional_1" type="data" format="fasta"/>
    <repeat name="data_tracks" title="Annotation Track">
        <conditional name="data_format">
            <param type="select" label="Track Type" name="data_format_select">
                <option value="gene_calls">GFF/GFF3/BED Featuers</option>
                <option value="pileup">BAM Pileups</option>
                <option value="wiggle">Wig/BigWig XY Data</option>
            </param>
            <when value="gene_calls">
                <param label="Track Data" help="in GFF, GFF3, BED"
                    format="gff,gff3,bed" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
            </when>
            <when value="pileup">
                <param label="Track Data" help="in BAM"
                    format="bam" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
            </when>
            <when value="wiggle">
                <param label="Track Data" help="in Wiggle or BigWig"
                    format="wig,bigwig" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
                <param label="Use XYPlot" help="instead of continuous coloured band"
                    format="boolean" name="xyplot" truevalue="JBrowse/View/Track/Wiggle/XYPlot"
                    falsevalue="JBrowse/View/Track/Wiggle/Density" />
                <param label="Show variane band" help="Only for XYPlots"
                    format="boolean" name="var_band" truevalue="true"
                    falsevalue="false" />
                <param label="Autoscale globally" help="instead of locall"
                    format="boolean" name="autoscale" truevalue="global"
                    falsevalue="local" />
            </when>
        </conditional>
    </repeat>
  </inputs>
  <outputs>
    <data format="html" name="default" label="JBrowse on $positional_1.name"/>
  </outputs>
  <help><![CDATA[
Deploy a static JBrowse visualization of a genome and some associated datasets

@ATTRIBUTION@
]]></help>
  <citations>
    <citation type="doi">10.1101/gr.094607.109</citation>
  </citations>
</tool>

