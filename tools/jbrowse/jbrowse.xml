<tool id="jbrowse" name="JBrowse" version="0.1">
  <description>genome browser</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <expand macro="stdio"/>
  <version_command>python jbrowse.py --version</version_command>
  <command interpreter="python"><![CDATA[jbrowse.py
$positional_1
$trackYaml

--jbrowse \${JBROWSE_SOURCE_DIR}
--outdir $default.files_path
> $default]]></command>
  <configfiles>
      <configfile name="trackYaml">
---
#for track in $data_tracks.data_format
  -
    file: $track.annotation
    ext: $track.annotation.ext
    label: "$track.label"
    #if str($data_tracks.data_format.data_format_select) == "wiggle":
    options:
        type: $track.xyplot
        variance_band: $track.var_band
      #if str($data_tracks.data_format.scaling.scale_select) == "auto_local":
        autoscale: local
      #else if str($data_tracks.data_format.scaling.scale_select) == "auto_global":
        autoscale: global
      #else:
        min: str($data_tracks.data_format.scaling.minimum)
        max: str($data_tracks.data_format.scaling.maximum)
      #end if
    #else if str($data_tracks.data_format.data_format_select) == "pileup":
    options:
        auto_snp: $track.auto_snp
    #end if
#end for
      </configfile>
  </configfiles>
  <inputs>
    <param label="Genome" name="positional_1" type="data" format="fasta"/>
    <repeat name="data_tracks" title="Annotation Track">
        <conditional name="data_format" label="Track Options">
            <param type="select" label="Track Type" name="data_format_select">
                <option value="gene_calls">GFF/GFF3/BED Featuers</option>
                <option value="pileup">BAM Pileups</option>
                <option value="wiggle">BigWig XY Data</option>
            </param>
            <when value="gene_calls">
                <param label="Track Data" help="in GFF, GFF3, BED"
                    format="gff,gff3,bed" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
            </when>
            <when value="pileup">
                <param label="Track Data" help="in BAM"
                    format="bam" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
                <param label="Autogenerate SNP Track" help="Not recommended for deep coverage BAM files"
                    type="boolean" name="auto_snp" truevalue="true" falsevalue="false" />
            </when>
            <when value="wiggle">
                <param label="Track Data" help="in BigWig"
                    format="bigwig" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
                <param label="Use XYPlot" help="instead of continuous coloured band"
                    type="boolean" name="xyplot" truevalue="JBrowse/View/Track/Wiggle/XYPlot"
                    falsevalue="JBrowse/View/Track/Wiggle/Density" />
                <param label="Show variane band" help="Only for XYPlots"
                    type="boolean" name="var_band" truevalue="true"
                    falsevalue="false" />

                <conditional name="scaling" label="Scaling">
                    <param type="select" label="Track Scaling" name="scale_select">
                        <option value="auto_local">Autoscale (local)</option>
                        <option value="auto_global">Autoscale (global)</option>
                        <option vlue="fixed">Specify Min/Max</option>
                    </param>
                    <when value="auto_local"></when>
                    <when value="auto_global"></when>
                    <when value="fixed">
                        <param label="Track minimum" name="minimum"
                            type="integer" value="0" />
                        <param label="Track maximum" name="maximum"
                            type="integer" value="100" />
                    </when>
                </conditional>
            </when>
        </conditional>
    </repeat>
  </inputs>
  <outputs>
    <data format="html" name="default" label="JBrowse on $positional_1.name"/>
  </outputs>
  <help><![CDATA[
Deploy a static JBrowse visualization of a genome and some associated datasets

@ATTRIBUTION@
]]></help>
  <citations>
    <citation type="doi">10.1101/gr.094607.109</citation>
  </citations>
</tool>

