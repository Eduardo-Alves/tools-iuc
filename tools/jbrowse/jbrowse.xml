<tool id="jbrowse" name="JBrowse" version="0.1">
  <description>genome browser</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <expand macro="stdio"/>
  <version_command>python jbrowse.py --version</version_command>
  <command interpreter="python"><![CDATA[jbrowse.py
$positional_1

#set data_files = '" "'.join([ str($var.annotation) for $var in $data_tracks.data_format ])
#set data_formats  = '" "'.join([ str($var.annotation.ext) for $var in $data_tracks.data_format ])
#set data_labels = '" "'.join([ str($var.annotation_label) for $var in $data_tracks.data_format ])
##set extra = '" "'.join([ str($var.annotation_extra) for $var in $data_tracks.data_format])

--annotation "$data_files"
--annotation_format "$data_formats"
--annotation_label "$data_labels"
##--annotation_extra "$extra"

--jbrowse \${JBROWSE_SOURCE_DIR}
--outdir $default.files_path
> $default]]></command>
  <inputs>
    <param label="Genome" name="positional_1" type="data" format="fasta"/>
    <repeat name="data_tracks" title="Annotation Track">
        <conditional name="data_format">
            <param type="select" label="Track Type" name="data_format_select">
                <option value="gene_calls">GFF/GFF3/BED Featuers</option>
                <option value="pileup">BAM Pileups</option>
                <option value="wiggle">Wig/BigWig XY Data</option>
            </param>
            <when value="gene_calls">
                <param label="Track Data" help="in GFF, GFF3, BED"
                    format="gff,gff3,bed" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
            </when>
            <when value="pileup">
                <param label="Track Data" help="in BAM"
                    format="bam" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
            </when>
            <when value="wiggle">
                <param label="Track Data" help="in Wiggle or BigWig"
                    format="wig,bigwig" name="annotation" type="data"/>
                <param label="Track Label" name="annotation_label" type="text"/>
            </when>
        </conditional>
    </repeat>
  </inputs>
  <outputs>
    <data format="html" name="default" label="JBrowse on $positional_1.name"/>
  </outputs>
  <help><![CDATA[
Deploy a static JBrowse visualization of a genome and some associated datasets

@ATTRIBUTION@
]]></help>
  <citations>
    <citation type="doi">10.1101/gr.094607.109</citation>
  </citations>
</tool>

