<tool id="trinity_analyze_diff_expr" name="Analyze differential expression" version="@WRAPPER_VERSION@.0">
    <description>using a Trinity assembly</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
    </expand>
    <expand macro="stdio"/>
    <command><![CDATA[

       analyze_diff_expr.pl

        --matrix "${matrix}"

        --samples "${samples}"

        --output results

    ]]></command>
    <inputs>
        <param format="tabular" name="matrix" argument="--matrix" type="data" label="Expression matrix" help="output of abundance_estimates_to_matrix tool"/>
        <param format="tabular" name="samples" argument="--samples" type="data" label="Sample description" help="file describing samples and replicates"/>
        <param format="tabular" name="DE_results" type="data_collection" collection_type="list" label="Differential expression results"/>
    </inputs>
    <outputs>
        <collection name="extracted_DE_genes" type="list" label="${tool.name} on ${on_string}: extracted differentially expressed genes">
            <discover_datasets pattern="(?P&lt;name&gt;.+)\.DE_results\.P.+_C.+\..+-UP.subset$" ext="tabular" />
        </collection>
        <collection name="summary_files" type="list" label="${tool.name} on ${on_string}: summary files">
            <data format="data" name="matrix" from_work_dir="results.matrix"/>
            <data format="data" name="matrix_log2_centered" from_work_dir="results.matrix.log2.centered.dat"/>
            <data format="data" name="matrix_log2_centered_heatmap" from_work_dir="results.matrix.log2.centered.genes_vs_samples_heatmap.pdf"/>
            <data format="data" name="matrix_log2" from_work_dir="results.matrix.log2.dat"/>
            <data format="data" name="matrix_log2_sample_cor" from_work_dir="results.matrix.log2.sample_cor.dat"/>
            <data format="data" name="matrix_log2_sample_cor_matrix" from_work_dir="results.matrix.log2.sample_cor_matrix.pdf"/>
            <data format="data" name="matrix_r" from_work_dir="results.matrix.R"/>
        </collection>
        <data format="data" name="rdata" label="${tool.name} on ${on_string}: RData file" from_work_dir="results.matrix.RData"/>
    </outputs>
    <tests>
        <test>
            <param name="matrix" value="count/qcheck/matrix.counts.matrix"/>
            <param name="samples" value="count/samples.txt"/>
            <param name="DE_results">
                <collection type="list">
                    <element name="input.matrix.wt_37_vs_wt_GSNO.DESeq2" value="count/exp_diff/input.matrix.wt_37_vs_wt_GSNO.DESeq2.DE_results" ftype="tabular" />
                    <element name="input.matrix.wt_37_vs_wt_ph8.DESeq2" value="count/exp_diff/input.matrix.wt_37_vs_wt_ph8.DESeq2.DE_results" ftype="tabular" />
                    <element name="input.matrix.wt_GSNO_vs_wt_ph8.DESeq2" value="count/exp_diff/input.matrix.wt_GSNO_vs_wt_ph8.DESeq2.DE_results" ftype="tabular" />
              </collection>
            </param>
            <output_collection name="extracted_DE_genes">
                <element name="input.matrix.wt_37_vs_wt_GSNO.DESeq2.DE_results.MA_n_Volcano" compare="sim_size" delta="100" file="count/exp_diff/input.matrix.wt_37_vs_wt_GSNO.DESeq2.DE_results.MA_n_Volcano.pdf"/>
                <element name="input.matrix.wt_37_vs_wt_ph8.DESeq2.DE_results.MA_n_Volcano" compare="sim_size" delta="100" file="count/exp_diff/input.matrix.wt_37_vs_wt_ph8.DESeq2.DE_results.MA_n_Volcano.pdf"/>
                <element name="input.matrix.wt_GSNO_vs_wt_ph8.DESeq2.DE_results.MA_n_Volcano" compare="sim_size" delta="100" file="count/exp_diff/input.matrix.wt_GSNO_vs_wt_ph8.DESeq2.DE_results.MA_n_Volcano.pdf"/>
            </output_collection>
        </test>
    </tests>
    <help>
<![CDATA[
Trinity_ assembles transcript sequences from Illumina RNA-Seq data.
This tool extracts the transcripts that are most differentially expressed (most significant FDR and fold-changes), once differential expression analyses have been runned. 

**Inputs**

This tool uses the matrix produced by 'Build expression matrix for a de novo assembly of RNA-Seq data by Trinity' tool.

You must describe your samples and replicates with a tabular file looking like this:

=========== ================
ConditionA  CondA_replicate1
----------- ----------------
ConditionA  CondA_replicate2
----------- ----------------
ConditionB  CondB_replicate1
----------- ----------------
ConditionB  CondB_replicate2
----------- ----------------
ConditionC  CondC_replicate1
----------- ----------------
ConditionC  CondC_replicate2
----------- ----------------
ConditionC  CondC_replicate3
=========== ================

It will probably be the same file as used in the tool 'RNASeq samples quality check for transcript quantification' or in the tool 'Run differential expression analysis'.
The names in column 2 must match the names given in the tool 'Build expression matrix for a de novo assembly of RNA-Seq data by Trinity'.


.. _Trinity: http://trinityrnaseq.github.io
]]>
    </help>

    <expand macro="citation" />
</tool>
