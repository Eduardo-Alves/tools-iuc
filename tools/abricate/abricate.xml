<tool id="abricate" name="ABRicate" version="0.1.0">
    <requirements>
        <requirement type="package" version="0.3">abricate</requirement>
        <requirement type="package" version="2.2.31">blast+</requirement>
    </requirements>

    <stdio>
        <exit_code range="1:" />
    </stdio>

    <command><![CDATA[
        abricate "$fasta_input"
        #if $settings.advanced == "advanced"
        $settings.no_header
        #if $settings.min_dna_id
        --minid=$settings.min_dna_id
        #end if
        #if $settings.cull_limit
        --cull=$settings.cull_limit
        #end if
        #end if
        > "$report"
    ]]></command>

    <inputs>
        <param name="fasta_input" type="data" format="fasta" label="Select fasta file" help="Specify fasta file to screen for antibiotic resistant genes"/>
        <conditional name="settings">
            <param name="advanced" type="select" label="Specify advanced parameters">
                <option value="simple" selected="true">No, use program defaults.</option>
                <option value="advanced">Yes, see full parameter list.</option>
            </param>
            <when value="simple">
            </when>
            <when value="advanced">
                <param name="no_header" type="boolean" label="Suppress header" truevalue="--noheader" falsevalue=""
                  help="Suppress output file's column headings" optional="true" />
                <param name="min_dna_id" type="integer" label="Minimum DNA identity" value="75" min="0" max="100" help="Minimum DNA identity (default 75, must be between 0-100)" optional="true" />
                <param name="cull_limit" type="integer" label="Culling limit" value="1" min="0" help="Culling limit (encompassing hits) (default 1, must be a positive number)" optional="true">
                    <validator type="in_range" message="This value must be greater than or equal to 0" min="0" max="2147483647"/>
                </param>
            </when>
        </conditional>
    </inputs>

    <outputs>
        <data format="tabular" name="report" label="${tool.name} on ${on_string} report file"/>
    </outputs>

    <tests>
        <!-- Basic test - will produce no results. -->
        <test>
            <param name="fasta_input" value="Acetobacter.fna"/>
            <param name="advanced" value="simple"/>
            <output name="report" ftype="tabular" file="output_noresults.txt" />
        </test>

        <!-- Basic test - will produce results. -->
        <test>
            <param name="fasta_input" value="MRSA0252.fna"/>
            <param name="advanced" value="simple"/>
            <output name="report" ftype="tabular" file="output_mrsa.txt" compare="contains"/>
        </test>

        <!-- Advanced test - No header. -->
        <test>
            <param name="fasta_input" value="MRSA0252.fna"/>
            <param name="advanced" value="advanced"/>
            <param name="no_header" value="True"/>
            <output name="report" ftype="tabular" file="output_noheader.txt" compare="contains"/>
        </test>

        <!-- Advanced test - Cull limit 100 -->
        <test>
            <param name="fasta_input" value="MRSA0252.fna"/>
            <param name="advanced" value="advanced"/>
            <param name="cull_limit" value="100"/>
            <output name="report" ftype="tabular" file="output_cull100.txt" compare="contains"/>
        </test>

        <!-- Advanced test - Min DNA ID 100 -->
        <test>
            <param name="fasta_input" value="MRSA0252.fna"/>
            <param name="advanced" value="advanced"/>
            <param name="min_dna_id" value="100"/>
            <output name="report" ftype="tabular" file="output_minid100.txt" compare="contains"/>
        </test>
    </tests>

    <help><![CDATA[
      Synopsis:
        ABRicate 0.3 - mass screening of contigs for antiobiotic resistance genes

      Author:
        Torsten Seemann <torsten.seemann@gmail.com>

      Usage: /usr/local/bin/abricate [options] <contigs.fasta> ...
        --list         List included ABR databases (default '0').

        --noheader     Suppress column header row (default '0').

        --minid=f       Minimum DNA identity (default '75').

        --cull=i        Culling limit (encompassing hits) (default '1').

    ]]></help>

    <citations>
      <citation type="bibtex">
        @UNPUBLISHED{Seemann2016,
        author = "Seemann T",
        title = "ABRicate: mass screening of contigs for antiobiotic resistance genes",
        year = "2016",
        note = "https://github.com/tseemann/abricate"}
      </citation>
    </citations>
</tool>
