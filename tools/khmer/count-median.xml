<tool	id="gedlab-khmer-count-median"
	name="Count Median"
	version="2.0rc1-1">

	<description>
		Count the median/avg k-mer abundance for each sequence in the
		input file, based on the k-mer counts in the given k-mer
		counting table. Can be used to estimate expression levels
		(mRNAseq) or coverage (genomic/metagenomic).
	</description>
        <macros>
		<token name="@BINARY@">count-median.py</token>
		<import>macros.xml</import>
        </macros>
	<expand macro="requirements" />
	<expand macro="stdio" />
	<expand macro="version" />
	<command><![CDATA[
@BINARY@
$input_counting_table_filename
$input_sequence_filename
$output_summary_filename
]]>
	</command>

	<inputs>
		<expand macro="input_sequence_filename" />
		<expand macro="input_counting_table_filename" />
	</inputs>
	<outputs>
		<data name="output_summary_filename" format="txt"
			label="${input_sequence_filename} sequence id, median, average, stddev, and seq length" />
	</outputs>
	<tests>
		<test>
			<param name="input_sequence_filename"
				value="test-abund-read-2.fa" />
			<param name="input_counting_table_filename"
				value="test-abund-read-2.ct" ftype="ct" />
                        <output name="output_summary_filename">
                                <assert_contents>
					<has_line_matching
						expression="seq 1001 1001.0 0.0 18" />
					<has_line_matching
						expression="895:1:37:17593:9954/1 1 103.803741455 303.702941895 114" />
                                </assert_contents>
                        </output>
		</test>
	</tests>
	<help>
Count the median/avg k-mer abundance for each sequence in the input file,
based on the k-mer counts in the given k-mer counting table. Can be used to
estimate expression levels (mRNAseq) or coverage (genomic/metagenomic). The
output file contains sequence id, median, average, stddev, and seq length;
fields are separated by spaces. For khmer 1.x count-median.py will split
sequence names at the first space which means that some sequence formats (e.g.
paired FASTQ in Casava 1.8 format) will yield uninformative names. Use
:option:`--csv` to fix this behavior.
	</help>
	<citations>
		<expand macro="software-citation" />
		<expand macro="diginorm-citation" />
	</citations>
</tool>
