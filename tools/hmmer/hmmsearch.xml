<?xml version="1.0"?>
<tool id="hmmer.hmmsearch" name="hmmsearch" version="@WRAPPER_VERSION@.0">
  <description>search profile(s) against a sequence database</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <expand macro="stdio"/>
  <command><![CDATA[
env;
which hmmsearch;

hmmsearch

#if 'tblout' in str($oformat):
    --tblout $tblout
#end if

#if 'domtblout' in str($oformat):
    --domtblout $domtblout
#end if

#if 'pfamtblout' in str($oformat):
    --pfamtblout $pfamtblout
#end if

#for i,oformat_opt in enumerate( str($oformat_opts).split(',') ):
    --$oformat_opt
#end for

-E $E
--domE $domE

#if $T:
-T $T
#end if

#if $domT:
--domT $domT
#end if

#if $incE:
--incE $incE
#end if

#if $incT:
--incT $incT
#end if

#if $incdomE:
--incdomE $incdomE
#end if

#if $incdomT:
--incdomT $incdomT
#end if

$cut_ga
$cut_nc
$cut_tc

$max
--F1 $F1
--F2 $F2
--F3 $F3
$nobias
$nonull2

#if $Z:
-Z $Z
#end if

#if $domZ:
--domZ $domZ
#end if


--cpu \${GALAXY_SLOTS:-2}
--seed $seed

$hmmfile
$seqdb
> $output
      ]]></command>
  <inputs>
      <param name="hmmfile" type="data" label="HMMER HMM model" />
      <!-- todo use Galaxy features like data libraries/data tables/??? -->
      <param name="seqdb" type="data" format="fasta"
          label="Sequence database to search against" />
      <!-- Options directing output -->
      <param name="oformat" multiple="True" display="checkboxes" label="Output Formats" help="Select output options" type="select">
          <option value="tblout" selected="true">Table of per-sequence hits (--tblout)</option>
          <option value="domtblout" selected="true">Table of per-domain hits (--domtblout)</option>
          <option value="pfamtblout" selected="true">Table of hits and domains in Pfam format (--pfamtblout)</option>
      </param>

      <param name="oformat_opts" multiple="True" display="checkboxes" label="Output Format Options" help="Select output options" type="select">
          <option value="acc">Prefer accessions over names in output (--acc)</option>
          <option value="noali">Don't output alignments, so output is smaller (--noali)</option>
          <option value="notextw" selected="true">Unlimited ASCII text output line width (--notextw)</option>
      </param>
      <!-- Options controlling reporting thresholds -->
      <param name="E" label="report sequences &lt;= this E-Value threshold in output"
          help="(-E)" value="10.0" type="float" min="0"/>
      <param name="domE" label="report domains &lt;= this E-Value threshold in output"
          help="(--domE)" value="10.0" type="float" min="0"/>

      <param name="T" label="report sequences &gt;= this score threshold in output"
          help="(-T)" type="float" optional="True"/>
      <param name="domT" label="report domains &gt;= this score threshold in output"
          help="(--domT)" type="float" optional="True"/>
      <!-- Options controlling inclusion (significance) thresholds -->
      <param name="incE" label="consider sequences &lt;= this E-Value threshold as significant"
          help="(--incE)" type="float" optional="True"/>
      <param name="incdomE" label="consider domains &lt;= this E-Value threshold as significant"
          help="(--incdomE)" type="float" optional="True"/>

      <param name="incT" label="consider sequences &gt;= this score threshold as significant"
          help="(--incT)" type="float" optional="True"/>
      <param name="incdomT" label="consider domains &gt;= this score threshold as significant"
          help="(--incdomT)" type="float" optional="True"/>
      <!-- Options controlling model-specific thresholding: -->
      <param name="cut_ga" type="boolean" truevalue="--cut_ga" label="use profile's GA gathering cutoffs to set all thresholding"
          help="(--cut_ga)" falsevalue="" />
      <param name="cut_nc" type="boolean" truevalue="--cut_nc" label="use profile's NC gathering cutoffs to set all thresholding"
          help="(--cut_nc)" falsevalue="" />
      <param name="cut_tc" type="boolean" truevalue="--cut_tc" label="use profile's TC gathering cutoffs to set all thresholding"
          help="(--cut_tc)" falsevalue="" />
      <!-- Options controlling acceleration heuristics -->
      <param name="max" type="boolean" truevalue="--max" label="Turn all heuristic filters off (less speed, more power)"
          help="(--max)" falsevalue="" />
      <param name="F1" type="float" label="Stage 1 (MSV) threshold: promote hits w/ P &lt;= F1"
          help="(--F1)" value="0.02"  />
      <param name="F2" type="float" label="Stage 2 (Vit) threshold: promote hits w/ P &lt;= F2"
          help="(--F2)" value="1e-3"  />
      <param name="F3" type="float" label="Stage 3 (Fwd) threshold: promote hits w/ P &lt;= F3"
          help="(--F3)" value="1e-5"  />
      <param name="nobias" type="boolean" truevalue="--nobias" label="Turn off composition bias filter"
          help="(--nobias)" falsevalue="" />
      <!-- Other options -->
      <param name="nonull2" type="boolean" truevalue="--nonull2" label="Turn off biased composition score corrections"
          help="(--nonull2)" falsevalue="" />
      <param name="Z" type="integer" label="# of comparisons done for E-value calculation"
          help="(-Z)" optional="True" />
      <param name="domZ" type="integer" label="# of significant sequences, for domain E-value calculation"
          help="(--domZ)" optional="True" />
      <param name="seed" label="RNG seed, 0 generates a random seed" value="42" type="integer" help="(--seed)"/>
  </inputs>
  <outputs>
    <data format="txt" name="output" label="HMM matches of $hmmfile.name in $seqdb.name"/>
    <data format="tabular" name="tblout" label="Table of per-sequence hits from HMM matches of $hmmfile.name in $seqdb.name">
        <filter>'tblout' in str(oformat)</filter>
    </data>
    <data format="tabular" name="domtblout" label="Table of per-domain hits from HMM matches of $hmmfile.name in $seqdb.name">
        <filter>'domtblout' in str(oformat)</filter>
    </data>
    <data format="pfam" name="pfamtblout" label="Table of per-sequence/per-domain hits from HMM matches of $hmmfile.name in $seqdb.name">
        <filter>'pfamtblout' in str(oformat)</filter>
    </data>

  </outputs>
  <tests>
      <test>
          <param name="hmmfile" value="globins4.hmm" />
          <param name="seqdb" value="uniprot_matches.fasta" />
          <param name="seed" value="4" />

          <output name="output" file="uniprot_globins_match.out" lines_diff="20"/>
          <output name="output" file="globins.domtblout" lines_diff="10"/>
          <output name="output" file="globins.pfamtblout" lines_diff="10"/>
          <output name="output" file="globins.tblout" lines_diff="10"/>
      </test>
  </tests>
  <help><![CDATA[
**What it does**

profile HMM construction from multiple sequence alignments

@ATTRIBUTION@
]]></help>
    <expand macro="citation" />
</tool>
