<?xml version="1.0"?>
<tool id="hmmer.hmmemit" name="hmmemit" version="@WRAPPER_VERSION@.0">
  <description>sample sequence(s) from a profile HMM</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <expand macro="stdio"/>
  <command><![CDATA[
hmmemit

#if $oformat.oformat_select == "fasta":
    -N $oformat.N_fa
#elif $oformat.oformat_select == "aln":
    -N $oformat.N_aln
    -a
#elif $oformat.oformat_select == "mrcs":
    -c
#elif $oformat.oformat_select == "mrcsf":
    --minl $oformat.minl
    --minu $oformat.minu
    -C
#else:
    -N $oformat.N_smp
    -p
    #if $oformat.L:
        -L $oformat.L
    #end if
    $oformat.emission_profiles
#end if


@SEED@

$hmmfile
> $output
      ]]></command>
  <inputs>
    <expand macro="input_hmm" />

    <conditional name="oformat">
        <param name="oformat_select" type="select" label="Output Format">
            <option value="fasta" selected="true">Fasta</option>
            <option value="aln">Alignment</option>
            <option value="mrcs">Majority-Rule Concensus Sequence</option>
            <option value="mrcsf">Fancier Concensus Sequence</option>
            <option value="sample">Sample sequences from profile, not core model</option>
        </param>
        <when value="fasta">
            <param name="N_fa" type="integer" value="1" min="1" help="(-N)"
                label="Number of sequences to generate"/>
        </when>
        <when value="aln">
            <param name="N_aln" type="integer" value="1" min="1" help="(-N)"
                label="Number of sequences to generate"/>
        </when>
        <when value="mrcs">
        </when>
        <when value="mrcsf">
            <param name="minl" type="float" value="0.7" help="(--minl)"
                label="show consensus as 'any' (X/N) unless >= this fraction"/>
            <param name="minu" type="float" value="0.2" help="(--minu)"
                label="show consensus as upper case if >= this fraction"/>
        </when>
        <when value="sample">
            <param name="N_smp" type="integer" value="1" min="1" help="(-N)"
                label="Number of sequences to generate"/>
            <param name="L" type="integer" optional="True" help="(-L)"
                label="Expected length of profile"/>

            <param name="emission_profiles" type="select" label="Emission profile options">
                <option value="--local" selected="true">configure profile in multihit local mode</option>
                <option value="--unilocal">configure profile in unilocal mode</option>
                <option value="--glocal">configure profile in multihit glocal mode</option>
                <option value="--uniglocal">configure profile in unihit glocal mode</option>
            </param>
        </when>
    </conditional>


    <expand macro="seed"/>
  </inputs>
  <outputs>
    <data format="fasta" name="output" label="Sequences generated from $hmmfile.name"/>
    <!-- TODO -->
  </outputs>
  <tests>
    <test>
      <param name="hmmfile" value="globins4.hmm"/>
      <param name="oformat_select" value="aln"/>
      <param name="N_aln" value="10"/>
      <expand macro="seed_test" />
      <output name="output" file="globins4-emit.sto" lines_diff="4"/>
    </test>
    <test>
      <param name="hmmfile" value="globins4.hmm"/>
      <param name="oformat_select" value="fasta"/>
      <param name="N_aln" value="10"/>
      <expand macro="seed_test" />
      <output name="output" file="globins4-emit-1.sto" lines_diff="4"/>
    </test>
  </tests>
  <help><![CDATA[
**What it does**

Generate (sample) sequences from a profile HMM.

@ATTRIBUTION@
]]></help>
  <expand macro="citation"/>
</tool>
