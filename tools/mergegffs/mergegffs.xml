 <tool id="mergegff" name="Merge gff using gffutils" version="1.0">
    <requirements>
        <requirement type="package" version="0.8">gffutils</requirement>
	      <requirement type="package" version="1.0">genomegtftools</requirement>
        <requirement type="package" version="1.66">biopython</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <version_command>
        <![CDATA[
            MergeGFF version 1.0
        ]]>
    </version_command>
    <command><![CDATA[


python $__tool_directory__/mergegffs.py  -p $gff -d $sqlitedb -o $output
#if $blastp:
    -b '$blastp'
#end if
#if $blastx:
    -x '$blastx'
#end if
#if $hmmscan:
    -f '$hmmscan'
#end if
#if $tmhmm:
    -t '$tmhmm'
#end if
#if $signalp:
    -s '$signalp'
#end if


    ]]></command>
    <inputs>
         <!--
        <param name="transcriptome" type="data" format="fasta" optional="false" label="Transcripts" help="Assembled Transcripts fasta" />
        <param name="peptides" type="data" format="fasta" optional="false" label="Peptide predictions" help="Predicted peptides in fasta format" />
        <param name="gene_trans_map" type="data" format="tabular" optional="false" label="Genes to transcripts map" help="Genes to transcripts map output. Containing correspondance between gene ids and transcript ids either generated by Trinity of generated with a clustering algorithm " />
      -->
        <param name="gff" type="data" format="gff" optional="false" label="Peptides coordinates" help="Peptides prediction coordinates in gff format " />

        <param name="blastp" type="data" format="tabular" optional="true" label="BLASTP: Peptides vs related species" help="[optional] NCBI BLAST+ blastp output. Output format: XML" />
        <param name="blastx" type="data" format="tabular" optional="true" label="BLASTX: Transcripts vs related species" help="[optional] NCBI BLAST+ blastx output. Output format: XML" />
        <param name="hmmscan" type="data" format="txt" optional="true" label="HMMER hmmscan: Peptides vs PFAM" help="[optional] HMMER hmmscan output: Table of per-domain hits. Output format: Table of per-domain hits (--domtblout)" />
        <param name="tmhmm" type="data" format="tabular" optional="true" label="TMHMM on Peptides" help="[optional]"/>
        <param name="signalp" type="data" format="tabular" optional="true" label="SignalP on Peptides" help="[optional]" />
        <!--
        <conditional name="cond_modify">
            <param name="select_existing" type="select" label="Use an existing gffutils db from history">
                <option value="yes" >Yes</option>
                <option value="no" selected="True">No</option>
            </param>
            <when value="yes">
                <param name="gffutils_sqlite_in" type="data" format="sqlite" optional="false" label="Existing GFFUtils SQLite database" help="http://daler.github.io/gffutils/index.html" />
            </when>
            <when value="no" />
        </conditional>
      -->
        <section name="filter_option" title="Filter options" expanded="False">
            <param argument="-E" type="float" value="1e-5" label="Maximum E-value for reporting best blast hit and associated annotations." />

        </section>
        <param name="keep_sqlite" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Keep the sqlite database file" help="Can be used for visualization purpose" />
    </inputs>
    <outputs>
        <data name="output" format="tabular" label="Merged gff" >
        </data>
        <data name="sqlitedb" format="sqlite" from_work_dir="Trinotate.sqlite" label="Trinotate sqlite database" >
            <filter>keep_sqlite</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="gff" value="Trinity.fasta.transdecoder.gff3" />
            <param name="blastp"  value="swissprot.blastp.outfmt6" />
            <param name="blastx"  value="swissprot.blastx.outfmt6" />
            <param name="hmmscan"  value="TrinotatePFAM.out" />
            <param name="tmhmm"  value="tmhmm.out" />
            <param name="signalp"  value="signalp.out" />
            <param name="keep_sqlite" value="false" />
            <output name="output" file="output.gff" />
        </test>

    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

This tool loads annotations from multiple tools into a gffutils sqlite database and outputs a single gff file containing all annotations.
The sqlite db can be used for filtering and visualization.

Based on https://github.com/galaxyproject/tools-iuc/tree/master/tools/trinotate


--------

**Suggested upstream Galaxy tools**

Transcripts

 - Trinity: iuc/trinity_

.. _trinity: https://toolshed.g2.bx.psu.edu/repository?repository_id=faf6028922d9220a

Peptides

 - TransDecoder: iuc/transdecoder_

.. _transdecoder: https://toolshed.g2.bx.psu.edu/repository?repository_id=7a2a8151a50f8099

Genes to transcripts map

 - Generate gene to transcript map for Trinity assembly: iuc/trinity_gene_to_trans_map_

.. _trinity_gene_to_trans_map: https://toolshed.g2.bx.psu.edu/repository?repository_id=faf6028922d9220a

BLASTP: Peptides vs Uniprot.SwissProt

 - NCBI BLAST+ blastp: devteam/ncbi_blast_plus_

.. _ncbi_blast_plus: https://toolshed.g2.bx.psu.edu/repository?repository_id=1d92ebdf7e8d466c

BLASTX: Transcripts vs Uniprot.SwissProt

 - NCBI BLAST+ blastx: devteam/ncbi_blast_plus_

.. _ncbi_blast_plus: https://toolshed.g2.bx.psu.edu/repository?repository_id=1d92ebdf7e8d466c

HMMER hmmscan: Peptides vs PFAM

 - HMMER hmmscan: iuc/hmmer_hmmscan_

.. _hmmer_hmmscan: https://toolshed.g2.bx.psu.edu/repository?repository_id=a2cc4683090b1800

TMHMM on Peptides

 - TMHMM 2.0: peterjc/tmhmm_and_signalp_

.. _tmhmm_and_signalp: https://toolshed.g2.bx.psu.edu/repository?repository_id=292389a45f1a238a

SignalP on Peptides

 - SignalP 3.0: peterjc/tmhmm_and_signalp_

.. _tmhmm_and_signalp: https://toolshed.g2.bx.psu.edu/repository?repository_id=292389a45f1a238a




--------


    ]]></help>
    <citations>

    </citations>
</tool>
