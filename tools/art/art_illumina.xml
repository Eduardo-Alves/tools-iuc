<tool id="art_illumina" name="ART Illumina" version="2014.11.03.0">
  <description>simulates sequencing data</description>
  <macros>
      <import>macros.xml</import>
  </macros>
  <expand macro="requirements" />
  <expand macro="stdio" />

  <stdio>
    <exit_code level="fatal" range="1:"/>
  </stdio>
  <command><![CDATA[
mkdir $output.files_path/;

art_illumina

#if $sam:
    --samout
#end if

#if not $aln:
    --noALN
#end if

#if str($generate.choice) == "paired_end":
    --paired
    --mflen $generate.mflen
    --sdev $generate.sdev
#else if str($generate.choice) == "mate_pair":
    --matepair
    --mflen $generate.mflen
    --sdev $generate.sdev
#end if

--in $input_seq_file
--len $read_length
--fcov $fold_coverage

$amplicon

--insRate $insRate
--insRate2 $insRate2
--delRate $delRate
--delRate2 $delRate2

#if $rndSeed and $rndSeed > -1:
    --rndSeed $rndSeed
#end if

--out $output.files_path/output

> $output;


## Move $output.files_path/output* to correct locations
#if $generate.choice == "single_end":
    mv $output.files_path/output.fq $output_fq1;
#else:
    mv $output.files_path/output1.fq $output_fq1;
    mv $output.files_path/output2.fq $output_fq2;
#end if

#if $aln:
    #if $generate.choice == "single_end":
        mv $output.files_path/output.aln $output_aln1;
    #else:
        mv $output.files_path/output1.aln $output_aln1;
        mv $output.files_path/output2.aln $output_aln2;
    #end if
#end if

#if $sam:
    mv $output.files_path/output.sam $output_sam;
#end if
]]></command>
  <inputs>
    <param label="DNA/RNA reference sequence" format="fasta" name="input_seq_file" type="data"/>
    <param label="the fold of read coverage over the reference sequences" name="fold_coverage" type="integer" value="20"/>
    <param label="length of reads to be simulated" name="read_length" type="integer" value="100"/>
    <param label="amplicon sequencing simulation" name="amplicon" type="boolean" truevalue="--amplicon" falsevalue="" />

    <conditional name="generate">
        <param name="choice" type="select" label="Type of data to generate">
            <option value="single_end">Single-End</option>
            <option value="paired_end">Paired-End</option>
            <option value="mate_pair">Mate-Pair</option>
        </param>
        <when value="single_end">
        </when>
        <when value="paired_end">
            <param label="Mean size of DNA/RNA fragments for paired-end simulations" name="mflen" type="integer" value="200" />
            <param label="Standard deviation of DNA/RNA fragment size for paired-end simulations" name="sdev" type="integer" value="10"/>
        </when>
        <when value="mate_pair">
            <param label="Mean size of DNA/RNA fragments for mate-pair simulations" name="mflen" type="integer" value="200" minimum="2000" />
            <param label="Standard deviation of DNA/RNA fragment size for paired-end simulations" name="sdev" type="integer" value="10"/>
        </when>
    </conditional>

    <expand macro="aln" />
    <expand macro="sam" />

    <param label="the first-read insertion rate" help="(--insRate)" name="insRate" type="float" value="0.00009" />
    <param label="the second-read insertion rate" help="(--insRate2)" name="insRate2" type="float" value="0.00015" />
    <param label="the first-read deletion rate" help="(--delRate)" name="delRate" type="float" value="0.00011" />
    <param label="the second-read deletion rate" help="(--delRate2)" name="delRate2" type="float" value="0.00023" />

    <expand macro="rndSeed" />
    <!-- todo: id, errfree, masN, qShift(2), sepProf -->
  </inputs>
  <outputs>
    <data format="txt" name="output" label="Illumina Sequencing Simulation Log"/>
    <data format="fastq" name="output_fq1"/>
    <data format="fastq" name="output_fq2">
        <filter>generate['choice'] != "single_end"</filter>
    </data>
    <data format="sam" name="output_sam">
        <filter>sam</filter>
    </data>

    <data format="aln" name="output_aln1">
        <filter>aln</filter>
    </data>
    <data format="aln" name="output_aln2">
        <filter>generate['choice'] != "single_end"</filter>
    </data>
  </outputs>
  <help><![CDATA[
Art Illumina Simulator
======================

ART (art_Illumina Q version) is a simulation program to generate sequence read
data of Illumina sequencers. ART generates reads according to the empirical
read quality profile summarized from large real read data. ART has been using
for testing or benchmarking a variety of methods or tools for next-generation
sequencing data analysis, including read alignment, de novo assembly, detection
of SNP, CNV, or other structure variation.

art_Illumina can generate single-end, paired-end,  mate-pair reads, and
amplicon sequencing simulation of Illumina sequencing platform. Its outputs
include FASTQ read, ALN and/or SAM alignment files.

      ]]></help>
  <tests>
      <test>
          <param name="rndSeed" value="42" />
          <param name="input_seq_file" value="input.fa" />
          <param name="fold_coverage" value="20" />
          <param name="read_length" value="200" />
          <param name="choice" value="single_end" />
          <param name="aln" value="True" />
          <param name="sam" value="True" />

          <output name="output" file="art.illumina.01.report" lines_diff="8"/>
          <output name="output_fq1" file="art.illumina.01.fq" />
          <output name="output_aln1" file="art.illumina.01.aln" lines_diff="2"/>
          <output name="output_sam" file="art.illumina.01.sam" lines_diff="2"/>
      </test>
      <test>
          <param name="rndSeed" value="42" />
          <param name="input_seq_file" value="input.fa" />
          <param name="fold_coverage" value="20" />
          <param name="read_length" value="200" />
          <param name="choice" value="paired_end" />
          <param name="mflen" value="300" />
          <param name="sdev" value="10" />
          <param name="aln" value="True" />
          <param name="sam" value="True" />

          <output name="output" file="art.illumina.02.report" lines_diff="12"/>
          <output name="output_fq1" file="art.illumina.021.fq" />
          <output name="output_fq2" file="art.illumina.022.fq" />
          <output name="output_aln1" file="art.illumina.021.aln" lines_diff="2"/>
          <output name="output_aln2" file="art.illumina.022.aln" lines_diff="2"/>
          <output name="output_sam" file="art.illumina.02.sam" lines_diff="2"/>
      </test>
  </tests>
  <expand macro="citation" />
</tool>

