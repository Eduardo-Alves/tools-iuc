<?xml version="1.0"?>
<tool id="bcftools_@EXECUTABLE@" name="bcftools @EXECUTABLE@" version="@VERSION@.0">
  <description>SNP/indel variant calling from VCF/BCF</description>
  <macros>
    <token name="@EXECUTABLE@">call</token>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <expand macro="stdio"/>
  <expand macro="version_command"/>
  <command>bcftools @EXECUTABLE@

## Consensus/variant calling section
${sec_consensus_variant_calling.consensus_caller}
#if $sec_consensus_variant_calling.constrain:
  --constrain "${sec_consensus_variant_calling.constrain}"
#end if
${sec_consensus_variant_calling.multiallelic_caller}
#if $sec_consensus_variant_calling.novel_rate:
  --novel-rate "${sec_consensus_variant_calling.novel_rate}"
#end if
#if $sec_consensus_variant_calling.pval_threshold:
  --pval-threshold "${sec_consensus_variant_calling.pval_threshold}"
#end if
#if $sec_consensus_variant_calling.prior:
  --prior "${sec_consensus_variant_calling.prior}"
#end if
${sec_consensus_variant_calling.chromosome_X}
${sec_consensus_variant_calling.chromosome_Y}

## File format section
#if $sec_file_format.output:
  --output "${sec_file_format.output}"
#end if
#if str($sec_file_format.select_output_type) != "__none__":
  --output-type "${sec_file_format.select_output_type}"
#end if
#set values_sec_file_format_regions = '","'.join([str($value) for $value in $sec_file_format.regions_repeat])
#if $values_sec_file_format_regions:
  --regions "${values_sec_file_format_regions}"
#end if
#if $sec_file_format.regions_file:
  --regions-file "${sec_file_format.regions_file}"
#end if
#set values_sec_file_format_samples = '","'.join([str($value) for $value in $sec_file_format.samples_repeat])
#if $values_sec_file_format_samples:
  --samples "${values_sec_file_format_samples}"
#end if
#if $sec_file_format.samples_file:
  --samples-file "${sec_file_format.samples_file}"
#end if
#set values_sec_file_format_targets = '","'.join([str($value) for $value in $sec_file_format.targets_repeat])
#if $values_sec_file_format_targets:
  --targets "${values_sec_file_format_targets}"
#end if
#if $sec_file_format.targets_file:
  --targets-file "${sec_file_format.targets_file}"
#end if

## Input/output section
${sec_input_output.keep_alts}
#set values_sec_input_output_format_fields = '","'.join([str($value) for $value in $sec_input_output.format_fields_repeat])
#if $values_sec_input_output_format_fields:
  --format-fields "${values_sec_input_output_format_fields}"
#end if
#if $sec_input_output.gvcf:
  --gvcf "${sec_input_output.gvcf}"
#end if
${sec_input_output.insert_missed}
${sec_input_output.keep_masked_ref}
#if $sec_input_output.skip_variants:
  --skip-variants "${sec_input_output.skip_variants}"
#end if
${sec_input_output.variants_only}

## Primary Input/Outputs

$input_file
&gt;
$output_file</command>
  <inputs>
    <param format="vcf,bcf" label="VCF/BCF Data" name="input_file" type="data"/>
    <section expanded="true" name="sec_consensus_variant_calling" title="Consensus/variant calling Options">
      <param falsevalue="" help="the original calling method (conflicts with -m)" label="Consensus Caller" name="consensus_caller" truevalue="--consensus-caller" type="boolean"/>
      <param help="one of: alleles, trio (see manual)" label="Constrain" name="constrain" optional="True" type="string"/>
      <param falsevalue="" help="alternative model for multiallelic and rare-variant calling (conflicts with -c)" label="Multiallelic Caller" name="multiallelic_caller" truevalue="--multiallelic-caller" type="boolean"/>
      <param default="1e-8,1e-9,1e-9" help="likelihood of novel mutation for constrained trio calling, see man page for details" label="Novel Rate" name="novel_rate" optional="True" type="float"/>
      <param default="0.5" help="variant if P(ref|D)&lt;FLOAT with -c" label="Pval Threshold" name="pval_threshold" optional="True" type="float"/>
      <param default="1.1e-3" help="mutation rate (use bigger for greater sensitivity)" label="Prior" name="prior" optional="True" type="float"/>
      <param falsevalue="" help="haploid output for male samples (requires PED file with -s)" label="Chromosome X" name="chromosome_X" truevalue="--chromosome-X" type="boolean"/>
      <param falsevalue="" help="haploid output for males and skips females (requires PED file with -s)" label="Chromosome Y" name="chromosome_Y" truevalue="--chromosome-Y" type="boolean"/>
    </section>
    <section expanded="true" name="sec_file_format" title="File format Options">
      <expand macro="macro_output"/>
      <expand macro="macro_select_output_type"/>
      <expand macro="macro_regions_repeat"/>
      <expand macro="macro_regions_file"/>
      <expand macro="macro_samples_repeat"/>
      <param format="data" help="PED file or a file with optional second column for ploidy (0, 1 or 2) [all samples]" label="Samples File" name="samples_file" optional="True" type="data"/>
      <expand macro="macro_targets_repeat"/>
      <expand macro="macro_targets_file"/>
    </section>
    <section expanded="true" name="sec_input_output" title="Input/output Options">
      <param falsevalue="" help="keep all possible alternate alleles at variant sites" label="Keep Alts" name="keep_alts" truevalue="--keep-alts" type="boolean"/>
      <repeat name="format_fields_repeat" title="Format Fields">
        <param help="output format fields: GQ,GP (lowercase allowed) []" label="Format Fields" name="format_fields"/>
      </repeat>
      <param __TODO__="TODO" help="output gVCF blocks of homozygous REF calls" label="Gvcf" name="gvcf"/>
      <param falsevalue="" help="output also sites missed by mpileup but present in -T" label="Insert Missed" name="insert_missed" truevalue="--insert-missed" type="boolean"/>
      <param falsevalue="" help="keep sites with masked reference allele (REF=N)" label="Keep Masked Ref" name="keep_masked_ref" truevalue="--keep-masked-ref" type="boolean"/>
      <param __TODO__="TODO" help="skip indels/snps" label="Skip Variants" name="skip_variants"/>
      <param falsevalue="" help="output variant sites only" label="Variants Only" name="variants_only" truevalue="--variants-only" type="boolean"/>
    </section>
  </inputs>
  <outputs>
    <data format="vcf" name="output_file">
      <change_format>
        <when format="bcf_bgz" input="sec_file_format|select_output_type" value="b"/>
        <when format="bcf" input="sec_file_format|select_output_type" value="u"/>
        <when format="vcf_bgz" input="sec_file_format|select_output_type" value="z"/>
        <when format="vcf" input="sec_file_format|select_output_type" value="v"/>
      </change_format>
    </data>
  </outputs>
  <tests/>
  <help>SNP/indel variant calling from VCF/BCF. To be used in conjunction with samtools mpileup. This command replaces the former "bcftools view" caller. Some of the original functionality has been temporarily lost in the process of transition to htslib, but will be added back on popular demand. The original calling model can be invoked with the -c option.</help>
  <expand macro="citations"/>
</tool>
