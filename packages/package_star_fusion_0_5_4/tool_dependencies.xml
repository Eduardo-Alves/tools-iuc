<?xml version='1.0' encoding='utf-8'?>
<tool_dependency>
    <package name="perl" version="5.18.1">
        <repository name="package_perl_5_18" owner="iuc" prior_installation_required="True" />
    </package>
    <package name="berkeley_db" version="1.86">
        <repository name="package_berkeley_db_1_86" owner="iuc" prior_installation_required="True" />
    </package>
    
    <package name="star_fusion" version="0.5.4">
        <install version="1.0">
            <actions>
                <!-- downloading the archive-url is not sufficient because it includes submodules -->
                <action type="shell_command">git clone --recursive https://github.com/STAR-Fusion/STAR-Fusion.git star_fusion &amp;&amp; cd star_fusion &amp;&amp; git reset --hard 26e115fa8ac8ec9956a517b288cfcde0a268570e</action>
                
                <action type="setup_perl_environment">
                    <repository name="package_perl_5_18" owner="iuc">
                        <package name="perl" version="5.18.1" />
                    </repository>
                    <repository name="package_berkeley_db_1_86" owner="iuc">
                        <package name="berkeley_db" version="1.86" />
                    </repository>
                
                    <package>https://github.com/bgruening/download_store/raw/master/jbrowse/URI-1.67.tar.gz</package>
                    <package>http://search.cpan.org/CPAN/authors/id/B/BE/BENBOOTH/Set-IntervalTree-0.02.tar.gz</package>
                </action>
                
                <!-- The DB_File needs some configuration to link to the berkeley_db package because it doesn't pick up C_INCLUDE_PATH -->
                <action type="download_by_url">https://cpan.metacpan.org/authors/id/P/PM/PMQS/DB_File-1.835.tar.gz</action>
                <action type="shell_command"><![CDATA[
                    cd ../DB_File-1.835 &&
                    
                    sed -i.bak "s@INCLUDE\t= /usr/local/BerkeleyDB/@INCLUDE\t= $BERKELEY_DB_ROOT_PATH/@" config.in &&
                    sed -i.bak "s@LIB\t= /usr/local/BerkeleyDB/lib@LIB\t= $BERKELEY_DB_ROOT_PATH/PORT/linux@" config.in &&
                    
                    perl Makefile.PL INSTALL_BASE=$INSTALL_DIR && make && make install
                ]]></action>
                
                <action type="move_directory_files"><!-- The binary is in the root directory of the package -->
                    <source_directory>.</source_directory>
                    <destination_directory>$INSTALL_DIR/bin</destination_directory>
                </action>
                <action type="set_environment">
                    <environment_variable action="prepend_to" name="PATH">$INSTALL_DIR/bin</environment_variable>
                    <environment_variable action="prepend_to" name="PATH">$INSTALL_DIR/bin/FusionFilter</environment_variable>
                    <environment_variable action="set_to" name="STAR_FUSION_PATH">$INSTALL_DIR/bin</environment_variable>
                    
                    <environment_variable action="append_to" name="PERL5LIB">$INSTALL_DIR/bin</environment_variable>
                    <environment_variable action="append_to" name="PERL5LIB">$INSTALL_DIR/bin/lib</environment_variable>
                    <environment_variable action="append_to" name="PERL5LIB">$INSTALL_DIR/lib/perl5/</environment_variable>	
                </action>
            </actions>
        </install>
        <readme>This package installs STAR-Fusion 0.5.4.</readme>
    </package>
</tool_dependency>
